<html>
  <head>
    <script src="js/fdb-all.min.js"></script>
    <script type="text/javascript" src="js/jquery-1.12.2.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <link href="css/bootstrap.css" rel="stylesheet">
    <script>
      var fdb = new ForerunnerDB();
      var db = fdb.db("db");
      var contactCollection = db.collection("contact")
      
      function after_load(){
        for(var i=0;i<contactCollection.find().length;i++){
          $("tbody").append("<tr><td>"+contactCollection.find()[i].name+"</td><td>"+contactCollection.find()[i].email+"</td><td>"+contactCollection.find()[i].tel+"</td><td><a class='btn btn-default btn_remark' data-id='"+i+"'>詳細</a></td><td><a class='btn btn-default btn_delete' id='"+i+"'>刪除</a></td></tr>");
        }
        $("body").on("click",".btn-default",function(){
          var contact_id = $(this).attr("data-id")/1;
          var contact_save = contactCollection.find({id:contact_id});
          alert(contact_save[0].remark);
        })
        $(".btn_remark").click(function(){
          var con_size = contactCollection.find().length;
          var new_id = contactCollection.find()[con_size - 1].id + 1;
          contactCollection.insert(new contact($("#new_name").val(),$("#new_email").val(),$("#new_phone").val(),$("#new_note").val(),new_id));
          $("tbody").append("<tr><td>"+contactCollection.find()[new_id].name+"</td><td>"+contactCollection.find()[new_id].email+"</td><td>"+contactCollection.find()[new_id].tel+"</td><td><a class='btn btn-default btn_remark' data-id='"+i+"'>詳細</a></td><td><a class='btn btn-default btn_delete' id='"+i+"'>刪除</a></td></tr>");
          contactCollection.save();
          $("#new_name").val("");
          $("#new_email").val("");
          $("#new_phone").val("");
          $("#new_note").val("");
        })
      }
      
      function contact(name,email,tel,remark,id){
        this.name = name;
        this.email = email;
        this.tel = tel;
        this.remark = remark;
        this.id = id;
      }
      
      function save_contact(){
        contactCollection.insert(new contact("123","hello@gmail.conm","0987-654-321","有個弟弟,叫456",0));
        contactCollection.insert(new contact("456","HI@gmail.com","0959-487-487","有個哥哥,叫123",1));
        contactCollection.save();
      }
      
      contactCollection.load(after_load);
    </script>
  </head>
  <body>
    <br>
    <div class="row">
      <div class="container">
        <div class="row">
          <div class="col-md-6">
            <form action="" class="form-horizontal">
              <div class="form-group">
                <label class="col-md-2 control-label" for="">姓名</label>
                <div class="col-md-10">
                  <input type="text" id="new_name" class="form-control" placeholder="王小明">
                </div>
              </div>
              <div class="form-group">
                <label class="col-md-2 control-label" for="">信箱</label>
                <div class="col-md-10">
                  <input type="email" id="new_email" class="form-control" placeholder="wang@gmail.com">
                </div>
              </div>
              <div class="form-group">
                <label class="col-md-2 control-label" for="">電話</label>
                <div class="col-md-10">
                  <input type="text" id="new_phone" class="form-control" placeholder="0912-345-678">
                </div>
              </div>
              <div class="form-group">
                <label class="col-md-2 control-label" for="">備註</label>
                <div class="col-md-10">
                  <textarea name="" id="new_note" class="form-control" id="" cols="30" rows="10"></textarea>
                </div>
              </div>
              <div class="form-group">
                <div class="col-md-12">
                  <input type="button" value="新增" id="add_contact_btn" class="btn pull-right btn-primary">
                </div>
              </div>
            </form>
          </div>
          <!-- col-md-6 end -->
        </div>
        <hr>
        <div class="row">
          <div class="col-md-12">
            <table class="table">
              <thead>
                <tr>
                  <td>姓名</td>
                  <td>信箱</td>
                  <td>電話</td>
                  <td></td>
                </tr>
              </thead>
              <tbody>
                <tr>

                </tr>
              </tbody>
            </table>
          </div>
          <!-- col-md-12 end -->
        </div>
      </div>
    </div>
  </body>
</html>
